---
import { themeConfig } from '@/config'
const { src } = Astro.props
console.log(src)

---

{src && (
<img src={src} alt="Profile picture" class="profile-pic" />
)}

<script
  is:inline
  define:vars={{
    contentWidth: themeConfig.general.contentWidth,
    centeredLayout: themeConfig.general.centeredLayout,
    toc: themeConfig.post.toc
  }}
>
  ;(function () {
    // Adjust back button position based on layout and screen size
    function adjustProfilePicPosition() {
      const button = document.querySelector('.profile-pic')
      if (!button) return

      // If not using centered layout, remove fixed positioning
      if (!centeredLayout) {
        button.classList.remove('fixed-position')
        button.style.left = ''
        return
      }

      // Calculate available margin space for positioning
      const pageWidth = window.innerWidth
      const contentWidthValue = parseFloat(contentWidth)
      // Apply the same minimum width logic as in BaseLayout
      const widthValue = Math.min(contentWidthValue, 50)
      const shouldUseCustomWidth = widthValue > 25
      const finalWidthValue = shouldUseCustomWidth ? widthValue : 25
      const margin = (pageWidth - finalWidthValue * 16) / 2
      const baseMinSpace = 11 * 16 // Base minimum space needed
      // If toc is enabled, need additional 2.5rem (40px) space
      const minSpace = toc ? baseMinSpace + 52 : baseMinSpace + 12

      // Position button fixed on the left if there's enough space
      if (margin >= minSpace) {
        button.classList.add('fixed-position')
        const basePosition = margin - baseMinSpace
        // If toc is enabled, move 2.5rem (40px) further left
        const leftPosition = toc ? basePosition - 40 : basePosition
        button.style.left = `${leftPosition}px`
      } else {
        button.classList.remove('fixed-position')
        button.style.left = ''
      }
    }

    adjustProfilePicPosition()

    document.addEventListener('astro:page-load', () => {
      adjustProfilePicPosition()
    })
    document.addEventListener('DOMContentLoaded', () => {
      adjustProfilePicPosition()
    })
    window.addEventListener('resize', adjustProfilePicPosition)
  })()
</script>

<style>
  .profile-pic {
    width: 12rem;
    display: inline-flex;
    align-items: center;
    gap: 0.375rem;
    position: relative;
    padding: 0;
  }


  .profile-pic svg {
    width: 0.8rem;
    height: 0.8rem;
    flex-shrink: 0;
  }

  .profile-pic.fixed-position {
    position: fixed;
    top: 6rem;
    margin-bottom: 0;
    padding-left: 0.75rem;
    z-index: 10;
  }
</style>
